
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Cart | BookStore</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">

  <style>
    .cart-container { padding: 40px 10%; }
    .cart-title { font-size: 32px; margin-bottom: 20px; color: #134e4a; }
    .cart-empty { text-align: center; font-size: 18px; color: #6b7280; margin-top: 40px; }

    .cart-grid {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
    }

    .cart-item {
        background: #ffffff;
        border-radius: 14px;
        padding: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .cart-image {
        width: 90px;
        height: 120px;
        background: #f1f5f9;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6b7280;
        font-size: 14px;
    }

    .cart-details { flex: 1; }
    .cart-details h3 { font-size: 18px; margin-bottom: 6px; }
    .cart-price { color: #0f766e; font-weight: 600; margin-bottom: 10px; }

    .cart-actions {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .cart-actions input {
        width: 60px;
        padding: 6px;
        border-radius: 6px;
        border: 1px solid #d1d5db;
        text-align: center;
    }

    .cart-actions button {
        padding: 6px 12px;
        border-radius: 6px;
        border: none;
        background: #0f766e;
        color: #fff;
        cursor: pointer;
    }

    .remove-link {
        color: #dc2626;
        text-decoration: none;
        font-size: 14px;
    }

    .summary {
        background: #ffffff;
        border-radius: 14px;
        padding: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        height: fit-content;
    }

    .summary h3 { margin-bottom: 16px; }
    .summary-total {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #0f766e;
    }

    @media (max-width: 900px) {
        .cart-grid { grid-template-columns: 1fr; }
    }

    @media (max-width: 600px) {
        .cart-container { padding: 20px; }
        .cart-item { flex-direction: column; }
        .cart-image { width: 100%; height: 140px; }
    }
  </style>
</head>

<body>

<header class="navbar">
  <div class="logo">ðŸ“š BookStore</div>

  <nav class="nav-links">

    <!-- ===== HOME (ALWAYS VISIBLE) ===== -->
    <a href="/">Home</a>

    <!-- ===== GUEST ===== -->
    <a href="/books" th:if="${session.loggedUser == null}">Books</a>
    <a href="/login" th:if="${session.loggedUser == null}" class="btn-outline">Login</a>
    <a href="/register" th:if="${session.loggedUser == null}" class="btn">Register</a>

    <!-- ===== USER ===== -->
    <a href="/books"
       th:if="${session.loggedUser != null and session.role == 'USER'}">
      Books
    </a>

    <a href="/cart"
       th:if="${session.loggedUser != null and session.role == 'USER'}">
      Cart
    </a>

    <a href="/orders"
       th:if="${session.loggedUser != null and session.role == 'USER'}">
      Orders
    </a>

    <!-- ===== ADMIN ===== -->
    <a href="/admin/books"
       th:if="${session.loggedUser != null and session.role == 'ADMIN'}">
      Admin Dashboard
    </a>

    <!-- ===== LOGOUT ===== -->
    <a href="/logout"
       th:if="${session.loggedUser != null}"
       class="btn-outline">
      Logout
    </a>

  </nav>

  <div class="menu-toggle" onclick="toggleMenu()">â˜°</div>
</header>



<div class="cart-container">

  <h2 class="cart-title">Your Cart</h2>

  <div th:if="${#lists.isEmpty(cartItems)}" class="cart-empty">
    Your cart is empty
  </div>

  <div th:if="${!#lists.isEmpty(cartItems)}" class="cart-grid">

    <!-- CART ITEMS -->
    <div>

      <div class="cart-item" th:each="item : ${cartItems}">

        <div class="cart-image">Book</div>

        <!-- Find matching book -->
        <div th:each="book : ${books}"
             th:if="${book.id == item.bookId}"
             class="cart-details">

          <h3 th:text="${book.title}">Book Title</h3>

          <div class="cart-price">
            â‚¹ <span th:text="${book.price}">0</span>
          </div>

          <div class="cart-actions">

            <form action="/cart/update" method="post">
              <input type="hidden" name="cartItemId" th:value="${item.id}">
              <input type="number" name="quantity" min="1" th:value="${item.quantity}">
              <button type="submit">Update</button>
            </form>

            <a class="remove-link"
               th:href="@{/cart/delete/{id}(id=${item.id})}">
              Remove
            </a>

          </div>

        </div>

      </div>

    </div>

    <!-- SUMMARY -->
    <div class="summary">
      <h3>Order Summary</h3>
      <div class="summary-total">
        Total: â‚¹ <span th:text="${total}">0</span>
      </div>

      <a href="/order/checkout" class="btn">
        Proceed to Checkout
      </a>
    </div>

  </div>

</div>

<script>
  function toggleMenu() {
      document.querySelector(".nav-links").classList.toggle("active");
  }
</script>

</body>
</html>
